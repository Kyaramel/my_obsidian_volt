# 📋 基本情報

- **パッケージ名**: `sabacan_robomas_mock`
- **優先度**: `中`
- **予定工数**: 1日でできる！！

# 🎯 パッケージ概要

## 目的

サバ缶ロボマスパッケージでは、ros2_socketcanを使用して外部のサバ缶基板とcan通信を行い、モータ制御を行っている。サバ缶を使用してモータを制御するノードを作成したとき、厳密な動作を確認するためには実機が必要である。本パッケージでは、実機を使用せずに、sabacan_robomas_refトピックをsubscribeしたら、sabacan_robomas_statusをpublishするという簡易的な実装で、動作を確認できるようなノードおよびパッケージの作成を目的とする。

## 主要機能

- パラメータ
	- ボードid
	- 出力する電流値[A]
	- 出力する速度[rad/s]
- `/sabacan_robomas_ref<board_id>`を受け取ったら、`/sabacan_robomas_status<board_id>`を送信
- `/sabacan_robomas_stautus`の出力内容
	- refの符号（+-）によって出力する値の符号も合わせる
	- torqueには電流、speedには速度を出力する（この値はパラメータで設定した数値にする）
	- posはパラメータで設定した速度に応じて変化させる（例: 2pi rad/sで1s経過 → 2pi [rad]）
- refで取得したモータ番号に対してフィードバックを送信する

# 📡 通信仕様

## パブリッシュするトピック

- `/sabacan_robomas_status<board_id>`
	- 型: `sabacan_msgs/msg/SabacanRobomasStatus`
	- 用途: ロボマスモータのフィードバック

## サブスクライブするトピック

- `/sabacan_robomas_ref<board_id>`
	- 型: `sabacan_msgs/msg/SabacanRobomasRef`
	- 用途: ロボマスモータへの指令値

## サービス
- なし

## アクション
- なし

# ⚙️ パラメータ
- `board_id`
	- 型: int
	- 用途: ボードID
- `current_output`
	- 型: float
	- 用途: フィードバックで出力する電流値[A]
- `velocity_output`
	- 型: float
	- 用途: フィードバックで出力する速度[rad/s]

# 作業指示

- まず、最初にパッケージのディレクトリ構造と、メインの処理の構成を提示すること
- メインの処理について、どのような関数を作成し、どういう処理を実行するのか説明すること
- これらの設計構想を確認し、受理されるまでパッケージやノードは作成しないこと
- 受理され次第、実装作業を行い、完成したら教えてください
- colcon buildの指示がされたら、指定されたディレクトリでビルドを実行すること
- エラーが発生した場合は、まず、どういうエラーが発生したのかエラーコードを解析し、何が原因なのか特定すること
- 問題の原因が特定でき次第、修正作業を行うこと
- nodeの主要な処理を、ROS2のapi依存部と、純粋な計算部に明確に分離させること
	- ノードクラス
		- action, subscriber, publisher, timerなどのインスタンス化とROS2 apiの呼び出しのみを担当
		- ROS2のコールバック関数をシンプルに保つこと
	- ロジックの分離
		- ノードクラスとは別に、独立したstaticなヘルパー関数を定義すること
	- 状態管理
		- モータの現在角度、目標速度などの内部状態は、ノードクラス内のプライベートなメンバ変数で管理すること
	- コードの配置
		- 計算ロジックやヘルパークラスの定義は、メインのnodeファイル内に直接定義せず、別のヘッダファイルに配置してください
	- デバッグ
		- RCLCPP_INFOなどを使用して、容易にデバッグが行えるようにしてください
	- テスト
		- 一応ros2 testが行えるようにしてください

# 📝 ドキュメント要件

- `[ ] README.md作成`
- `[ ] 使用例（動作確認用のコマンド）`
- `[ ] プログラム内のすべての関数に日本語でコメントをつける`

