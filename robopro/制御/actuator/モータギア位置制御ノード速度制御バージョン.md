# 📋 基本情報

- **パッケージ名**: `gear_speed_control`
- **優先度**: `中`
- **予定工数**: `3日`

# 🎯 パッケージ概要

## 目的

外部からの指令に基づき、モータを特定の速度で駆動し、外部から**キャンセルされるまで**その速度を維持するノード。本ノードは、以前の位置制御ノードとActionインターフェースを統一することで、上位ノードの変更を最小限に抑えることを目的とする。

## 主要機能

- **速度指令の受信**: Action Goalとして目標速度 [rad/s] を取得する。
- **継続的な駆動**: Actionがキャンセルされるまで、`/sabacan_robomas_ref...` に**速度制御モード**（`control_type = "speed"`）と**目標速度**を継続的に送信する。
- **キャンセル時の停止**: Actionがキャンセルされたら、モータ駆動ノードに**停止指令**（例：アイドルモード）を送信する。
- **フィードバック**: モータの現在の移動位置[mm]をAction Feedbackとして送信する。
- **必要なパラメータ**: 制御モータボードID、モータ番号、制御周期[Hz]。

# 📡 通信仕様

## パブリッシュするトピック

- **トピック名**: `/sabacan_robomas_ref<board_id>/motor<motor_number>`
- **メッセージ型**: `sabacan_single_control_msgs/msg/sabacan_robomas_single_ref`
- **説明**: `モータの指令値`
- **頻度**: `control_frequency_hz` [Hz]

## サブスクライブするトピック

- **トピック名**: `/sabacan_robomas_status<board_id>`
- **メッセージ型**: `sabacan_msgs/msg/sabacan_robomas_status`
- **説明**: モータの角度フィードバックを取得
- **用途**: 速度フィードバックを抽出

## サービス

- **注意**: この速度制御ノードはリセット処理を行わないため、サービス機能は**不要**です。ただし、**インターフェースの統一**のため、将来のリセット処理に対応できるよう、以下の定義を仮に残します。（今回は使用しない）
- **サービス名**: `/gear_position_control_reset/board<board_id>/motor<motor_number>`
- **メッセージ型**: `std_srvs::srv::Trigger`
- **説明**: リセットフラグ
- **用途**: **（本ノードでは使用しない）**

## アクション

- **Action名を維持することで、上位ノードの変更を回避します。**
- **アクション名**: `/gear_position_control_ref_mm/board<board_id>/motor<motor_number>`
    - **ファイル名**: `GearPositionControl.action`
    - **説明**: モータを**指定速度で駆動し、キャンセルされるまで維持**する。
    - **Goal**: `std_msgs/Float32` **目標速度** [rad/s]
    - **Result**: `std_msgs/Float32` 最終的な到達**速度** [rad/s]
    - **Feedback**: `std_msgs/Float32` 移動中の現在**速度** [rad/s]

# ⚙️ パラメータ

- **`board_id`**
    - **型**: `int`
    - **デフォルト値**: 0
    - **説明**: モータボードID
- **`motor_number`**
    - **型**: `int`
    - **デフォルト値**: 0
    - **説明**: モータ番号
- **`control_frequency_hz`**
    - **型**: `int`
    - **デフォルト値**: 10
    - **説明**: 制御周期
- `gear_size`
	- 型: float
	- デフォルト値: 50.0
	- 用途: ギアの直径[mm]

# 📝 ドキュメント要件

- `[ ] README.md作成`
- `[ ] 使用例（動作確認用のコマンド）`
- `[ ] プログラム内のすべての関数に日本語でコメントをつける`