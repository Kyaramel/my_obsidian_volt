# 📋 基本情報

- **パッケージ名**: `gear_position_control`
- **優先度**: `高`
- **予定工数**: `1週間`

# 🎯 パッケージ概要

## 目的
モータの角度をエンコーダーから取得して、一定位置に移動するように指令を出力するノード。
特定のサービスを取得したら、エンコーダの値をリセットする機能も搭載する。
ここでいう位置制御とは、モータの角度制御のことではなく、モータに取り付けられた歯車が移動する距離[mm]を制御することを指す。
場合によっては、

## 主要機能
- モータの位置指令[mm]を取得する
- `sabacan_robomas_single_node`に指定した位置になるまで位置制御、角度指令値[rad]を送信
- モータの角度フィードバックを取得する
- パラメータ
	- ギアの直径[mm]
	- 制御するモータボードID
	- 制御するモータの番号
	- publish late [Hz]

# 📡 通信仕様

## パブリッシュするトピック

| トピック名                                                | メッセージ型                                                       | 説明        | 頻度                  |
| ---------------------------------------------------- | ------------------------------------------------------------ | --------- | ------------------- |
| `/sabacan_robomas_ref<board_id>/motor<motor_number>` | `sabacan_single_control_msgs/msg/sabacan_robomas_single_ref` | `モータの指令値` | `publish late [Hz]` |

## サブスクライブするトピック

| トピック名                               | メッセージ型                                    | 説明               | 用途             |
| ----------------------------------- | ----------------------------------------- | ---------------- | -------------- |
| `/sabacan_robomas_status<board_id>` | `sabacan_msgs/msg/sabacan_robomas_status` | モータの角度フィードバックを取得 | 制御するモータ角度のみを保持 |



## サービス

| サービス名                                                              | メッセージ型                   | 説明      | 用途         |
| ------------------------------------------------------------------ | ------------------------ | ------- | ---------- |
| `/gear_position_control_reset/board<board_id>/motor<motor_number>` | `std_srvs::srv::Trigger` | リセットフラグ | モータ角度のリセット |


## アクション
- アクション名`/gear_position_control_ref_mm/board<board_id>/motor<motor_number>`
	- ファイル名: `GearPositionControl.action`
	- モータを指定位置まで移動させる
	- Goal: `std_msgs/Float32` 目標距離[mm]
	- Result: `std_msgs/Float32` 最終的な到達位置[mm]
	- Feedback: `std_msgs/Float32` 移動中の現在位置[mm]


# ⚙️ パラメータ

| パラメータ名         | 型     | デフォルト値 | 説明        |
| -------------- | ----- | ------ | --------- |
| `board_id`     | int   | 0      | モータボードID  |
| `motor_number` | int   | 0      | モータ番号     |
| `gear_size`    | float | 50.0   | ギアの直径[mm] |
| `publish_late` | int   | 10     | 制御周期[Hz]  |

# 📝 ドキュメント要件

- `[ ] README.md作成`
- `[ ] 使用例（動作確認用のコマンド）`
